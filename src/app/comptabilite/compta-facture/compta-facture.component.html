
<ngx-spinner bdColor="rgba(0,0,0,0.8)" size="medium" color="#fff" type="square-jelly-box" [fullScreen]="true">
  <p class="text-white mt-4 font-medium italic text-sm">Récupération des archives...</p>
</ngx-spinner>

<div class="space-y-8 animate-fade-in mb-12">
  
  <!-- Page Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
    <div>
      <h1 class="text-2xl font-black text-secondary-900 tracking-tight">Archives des Factures</h1>
      <nav class="flex mt-1 text-sm text-secondary-500 font-medium">
        <a [routerLink]="['/accueil']" class="hover:text-primary-600 transition-colors">Accueil</a>
        <span class="mx-2 text-secondary-300">/</span>
        <span class="text-secondary-900 font-bold">Comptabilité</span>
        <span class="mx-2 text-secondary-300">/</span>
        <span class="text-secondary-400">Factures</span>
      </nav>
    </div>
    
    <div class="flex flex-wrap items-center gap-3">
      <div class="relative group">
        <select [(ngModel)]="annee" (change)="getClientAnnee(annee)"
          class="block w-full pl-10 pr-10 py-2.5 bg-white border border-secondary-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all text-sm font-bold text-secondary-700 appearance-none shadow-sm cursor-pointer min-w-[160px]">
          <option [ngValue]="undefined" disabled selected>Choisir une année</option>
          <option (click)="accueil()">Rechercher Client</option>
          <option *ngFor="let y of annees" [value]="y.annee">{{ y.annee }}</option>
        </select>
        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-secondary-400">
          <i class="bi bi-calendar3 text-[12px]"></i>
        </div>
        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-secondary-400">
           <i class="bi bi-chevron-down text-[10px]"></i>
        </div>
      </div>
      
      <div class="relative w-full sm:w-64 group">
        <input type="text" placeholder="Rechercher une facture..."
          class="w-full pl-10 pr-4 py-2.5 bg-white border border-secondary-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all text-sm font-bold text-secondary-700 placeholder:text-secondary-400 shadow-sm">
        <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none text-secondary-400 group-focus-within:text-primary-500 transition-colors">
          <i class="bi bi-search text-xs"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Invoices Table Section -->
  <div class="bg-white rounded-3xl shadow-elegant border border-secondary-100 overflow-hidden">
    <!-- Card Header -->
    <div class="px-8 py-6 border-b border-secondary-50 flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div>
        <h3 class="text-lg font-bold text-secondary-900 uppercase tracking-tight">Registre de Facturation</h3>
        <p class="text-xs text-secondary-500 mt-1 font-medium">Liste complète des documents émis pour {{ annee || 'toutes les périodes' }}</p>
      </div>
      <div class="flex items-center space-x-2">
         <span class="px-3 py-1 bg-primary-50 text-primary-600 rounded-lg text-[10px] font-black uppercase tracking-widest">{{ factures.length }} Documents</span>
      </div>
    </div>

    <!-- Table Container -->
    <div class="overflow-x-auto">
      <table class="w-full text-left whitespace-nowrap">
        <thead>
          <tr class="bg-secondary-50/50">
            <th class="px-8 py-5 text-[10px] font-black text-secondary-400 uppercase tracking-widest">Date Émission</th>
            <th class="px-4 py-5 text-[10px] font-black text-secondary-400 uppercase tracking-widest">Client & Contact</th>
            <th class="px-4 py-5 text-[10px] font-black text-secondary-400 uppercase tracking-widest text-center">Quantité</th>
            <th class="px-4 py-5 text-[10px] font-black text-secondary-400 uppercase tracking-widest text-right">Montant</th>
            <th class="px-4 py-5 text-[10px] font-black text-secondary-400 uppercase tracking-widest text-center">Statut</th>
            <th class="px-8 py-5 text-[10px] font-black text-secondary-400 uppercase tracking-widest text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-secondary-50">
          <tr *ngFor="let f of paginatedFactures; let i = index" class="hover:bg-primary-50/10 transition-all group">
            <td class="px-8 py-6">
              <div class="flex items-center space-x-3">
                 <div class="w-10 h-10 rounded-xl bg-secondary-50 flex items-center justify-center text-secondary-400 group-hover:bg-primary-50 group-hover:text-primary-500 transition-colors">
                    <span class="text-xs font-black">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</span>
                 </div>
                 <div>
                   <p class="text-sm font-black text-secondary-900">{{ f.dateVente | date:'dd MMMM yyyy' }}</p>
                   <p class="text-[10px] text-secondary-400 font-bold uppercase tracking-tighter">REF: FAC-{{ f.idFacture }}</p>
                 </div>
              </div>
            </td>
            <td class="px-4 py-6">
              <p class="text-sm font-black text-secondary-900">{{ f.nomClient }}</p>
              <p class="text-xs text-secondary-500 font-bold italic">{{ f.telClient }}</p>
            </td>
            <td class="px-4 py-6 text-center">
              <span class="px-2.5 py-1 bg-secondary-100 text-secondary-700 rounded-lg text-[10px] font-black uppercase tracking-tighter">
                {{ f.quantite }} ART.
              </span>
            </td>
            <td class="px-4 py-6 text-right">
              <div class="flex flex-col items-end">
                <span class="text-sm font-black text-secondary-900 tracking-tighter">{{ f.montant | number:'1.0' }}</span>
                <span class="text-[9px] font-black text-primary-500 tracking-widest uppercase mt-0.5">FCFA</span>
              </div>
            </td>
            <td class="px-4 py-6 text-center">
               <span class="px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest italic border"
                     [ngClass]="f.statut === 'Payée' ? 'bg-green-50 text-green-700 border-green-100' : 'bg-orange-50 text-orange-700 border-orange-100'">
                 {{ f.statut || 'En attente' }}
               </span>
            </td>
            <td class="px-8 py-6 text-right">
              <a [routerLink]="['../../clients/facture', f.idFacture]"
                 class="inline-flex items-center px-4 py-2 bg-secondary-900 border border-secondary-800 text-white hover:bg-black rounded-xl text-[10px] font-black uppercase tracking-widest transition-all shadow-sm group">
                <span class="mr-2">Séquence Détails</span>
                <i class="bi bi-arrow-right text-primary-400 group-hover:translate-x-1 transition-transform"></i>
              </a>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination Controls -->
      <div class="flex items-center justify-between p-8 border-t border-secondary-100" *ngIf="totalPages > 1">
          <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1" 
                  class="px-5 py-2.5 rounded-xl bg-white border border-secondary-200 text-secondary-600 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-secondary-50 transition-all font-black text-[10px] uppercase tracking-wider shadow-sm flex items-center">
              <i class="bi bi-chevron-left mr-2"></i> Précédent
          </button>
          
          <div class="flex gap-2">
              <button *ngFor="let page of pages" (click)="changePage(page)" 
                      [class.bg-primary-600]="currentPage === page" 
                      [class.text-white]="currentPage === page" 
                      [class.bg-white]="currentPage !== page" 
                      [class.text-secondary-600]="currentPage !== page"
                      class="w-9 h-9 rounded-xl flex items-center justify-center font-black text-xs transition-all shadow-sm border border-secondary-200"
                      [ngClass]="currentPage === page ? 'border-primary-600' : 'hover:bg-secondary-50'">
                  {{ page }}
              </button>
          </div>

          <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages" 
                  class="px-5 py-2.5 rounded-xl bg-white border border-secondary-200 text-secondary-600 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-secondary-50 transition-all font-black text-[10px] uppercase tracking-wider shadow-sm flex items-center">
              Suivant <i class="bi bi-chevron-right mr-2"></i>
          </button>
      </div>

      <!-- Empty State -->
      <div *ngIf="!factures.length" class="py-24 text-center">
        <div class="w-16 h-16 bg-secondary-100 rounded-full flex items-center justify-center mx-auto mb-4 text-secondary-300">
          <i class="bi bi-journal-x text-3xl"></i>
        </div>
        <p class="text-secondary-400 font-bold italic tracking-wide">Aucun document trouvé pour la période sélectionnée.</p>
        <button (click)="ngOnInit()" class="mt-4 text-primary-600 font-black text-xs uppercase tracking-widest hover:underline">Réinitialiser les filtres</button>
      </div>
    </div>
  </div>

</div>
